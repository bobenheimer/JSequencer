<!DOCTYPE html>
<html lang="en">
    <head>   
        <script src="javascript/Audiolet.js"></script>
        <script src="javascript/instruments.js"></script>
        <script src="javascript/JSequencer.js"></script>
        <script src="javascript/tests.js"></script>
        <script src="javascript/ui.js"></script>
        <script type="application/javascript">
        function draw() {
            var song = new Song();
            song.createTrack(Synth1);
            var a = [0, 30, 50, 60, 80, 90, 110, 120, 150, 170, 180, 200];
            //var scale = new Scale([0,1,2,3,4,5,6,7,8,9,10,11]);
            //console.log(scale.getFrequency(9, 4186.01, -8));
            
            var track = song.tracks[0];
            var pianoUI = new Piano(track);
        }
        /*var past = null;
        
        var song = new Song();
        song.createTrack(Synth1);
        var track = song.tracks[0];
        var fail = [0, 30, 50, 60, 80, 90, 110, 120, 150, 170, 180, 200, 210, 240, 260, 270, 290, 300, 320, 330, 360, 380, 390, 410, 420, 450, 570, 590, 600, 620, 630];
        var frequencies = [1046.50, 987.77, 932.33, 880.00, 830.61, 783.99, 739.99, 698.46, 659.26, 622.25, 587.33, 554.37, 523.25, 493.88, 466.16, 440.00, 415.30, 392.00, 369.99, 349.23, 329.63, 311.13, 293.66, 277.18, 261.63];

        var drawWhiteKey = function(x, y, height, width) {
            var canvas = document.getElementById('white-keys');
            var context = canvas.getContext("2d");
            context.fillStyle   = '#FFF'; 
            context.strokeStyle = '#000'; 
            context.lineWidth   = 0;
            context.fillRect  (x, y, height, width);
            context.strokeRect(x, y, height, width);            
        }
        
        var drawBlackKey = function(x, y, height, width) {
            var canvas = document.getElementById('black-keys');
            var context = canvas.getContext("2d");
            context.fillStyle   = '#000';
            context.strokeStyle = '#000';
            context.lineWidth   = 0;
            context.fillRect  (x, y, height, width);
            context.strokeRect(x, y, height, width);
        }
        
        var getNote = function(x, y) {
            var group = Math.floor(y / 210); //starting from top C8 - D7, C7 - C6 etc
            var noteRectangle = Math.floor(y / 30) % 7; //which white key it is in 0 is C, 1 is D .... 6 is B
            relativeNoteOffsetY = y % 30;
            //console.log(noteRectangle);
            if(noteRectangle == 0 || noteRectangle == 4) {
                if (x < 75 && relativeNoteOffsetY <= 10) {
                    //console.log(group * 210 - 10);
                    return group * 210 - 10 + noteRectangle * 30;
                }
            }
            else if(noteRectangle == 1 || noteRectangle == 5) {
                if (x < 75 && relativeNoteOffsetY >= 20) {
                    return group * 210 + 20 + noteRectangle * 30;
                }
            }
            else {
                if (x < 75 && relativeNoteOffsetY <= 10) {
                    //console.log(group * 210 - 10);
                    return group * 210 - 10 + noteRectangle * 30;
                }
                if (x < 75 && relativeNoteOffsetY >= 20) {
                    return group * 210 + 20 + noteRectangle * 30;
                }
            }
            
            var y = group * 210 + noteRectangle * 30;
            
            return y;
            //console.log(y);
        }
        
        var mapToNotes = function(y) {
            //console.log(y);
            var fuck = fail.indexOf(y);
            return frequencies[fuck];
        } 
        function draw() {
            var start = 0;
            var offset = 30;
            var numbWhiteKeys = 52;
            
            var guide = null;
            var piano =  document.getElementById('piano');
            piano.onmousemove = function(e) {
                var x = e.pageX - piano.offsetLeft;
                var y = e.pageY - piano.offsetTop;
                var drawY = getNote(x, y);
                //console.log(drawY);
                if (drawY == past) {
                    return;
                }
                else {
                    if (past != undefined) {
                        if (past % 30 == 0)
                            drawWhiteKey(0, past, 150, 30);
                        else 
                            drawBlackKey(0, past, 75, 20);
                        
                    }

                    if (drawY % 30 == 0) {
                        var canvas = document.getElementById('white-keys');
                        var context = canvas.getContext("2d");
                        past = drawY
                        context.fillStyle   = '#ABD'; 
                        context.strokeStyle = '#4FA'; 
                        context.lineWidth   = 0;
                        //context.fillRect  (x, y, height, width);
                        context.fillRect  (0, drawY, 150, 30);
                        context.strokeRect(0, drawY, 150, 30);                        
                    }
                    else {
                        //console.log("foo");
                        var canvas = document.getElementById('black-keys');
                        var context = canvas.getContext("2d");
                        past = drawY
                        context.fillStyle   = '#B0B';
                        context.strokeStyle = '#FAB';
                        context.lineWidth   = 0;
                        context.fillRect  (0, drawY, 75, 20);
                        context.strokeRect(0, drawY, 75, 20);
                    }
                    

                }
  
                

            }
            
            piano.onmousedown = function(e) {
                var x = e.pageX - piano.offsetLeft;
                var y = e.pageY - piano.offsetTop;
                var drawY = getNote(x, y);
                console.log(drawY);    
                track.playNote(new Note(mapToNotes(drawY), 0, 1, 1));
            }
            var notes = ['c', 'b', 'a', 'g', 'f', 'e', 'd', ];
           
            for(var i = 0; i < numbWhiteKeys; i++) {
                if (notes[i % 7] == 'c' || notes[i % 7] == 'f') {
                    drawWhiteKey(0, start * offset, 150, 30);                                    
                }
                else {
                    drawWhiteKey(0, start * offset, 150, 30);
                    drawBlackKey(0, start * offset + 20, 75, 20);  
                }
                start++;
            }


            



        } */
        </script>
        <meta charset="utf-8" />
        <title>JSequencer</title>
        <link type="text/css" rel="stylesheet" href="style/main.css">
    </head>
    <body onload="draw()">
    <div id="container">
        <div id="main">
           <!-- <div id="sequencer">-->
                <div id="piano">
                    <canvas id="white-keys"  width="200" height="2080"></canvas>                
                    <canvas id="black-keys"  width="200" height="2080"></canvas>            
                </div>
            <!--</div>-->
        </div>
    </div>
    <footer>
    <p class="poo">BUTTONS UP THE BUTT LMAO</p>
    </footer>
    </body>
</html>
   