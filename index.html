<!DOCTYPE html>
<html lang="en">
    <head>   
        <script src="javascript/Audiolet.js"></script>
        <script src="javascript/instruments.js"></script>
        <script src="javascript/JSequencer.js"></script>
        <script src="javascript/ui.js"></script> 
        <script type="application/javascript">
        function draw() {
            //console.time('foo');
            initialize();
            var sequencer = new Sequencer();
            
            try {
                var notes = JSON.parse(localStorage.getItem('notes'));
                var drawnNotes = JSON.parse(localStorage.getItem('drawnNotes'));
                var tempo = localStorage.getItem('tempo');
                
                if(tempo != null && tempo != undefined) {
                    sequencer.song.changeTempo(tempo);
                    document.getElementById('tempo').value = tempo;
                }
                if (notes != null && notes != undefined) {
                    sequencer.tracks[0].notes = JSON.parse(localStorage.getItem('notes'));
                }
                if (drawnNotes != null && drawnNotes != undefined) {
                    sequencer.grids[0].noteXLookup = JSON.parse(localStorage.getItem('drawnNotes'));
                    sequencer.grids[0].drawNotes();
                }
            }
            catch(err){
                console.log('derp');
                
                
            }

            setInterval(function() {
                localStorage.setItem('notes', JSON.stringify(sequencer.tracks[0].notes));
                localStorage.setItem('drawnNotes', JSON.stringify(sequencer.grids[0].noteXLookup));
                localStorage.setItem('tempo', sequencer.song.tempo);
            }, 1000);
            
            //console.log(JSON.stringify(sequencer.tracks[0].notes));
            //var testObject = { 'one': 1, 'two': 2, 'three': 3 };

            //localStorage['foo'] = 'bar';
            
            //console.log(localStorage['testObject']);
            // Put the object into storage
            //localStorage.setItem('testObject', JSON.stringify(testObject));
    
            // Retrieve the object from storage
            //var retrievedObject = localStorage.getItem('testObject');
    
            //console.log('retrievedObject: ', JSON.parse(retrievedObject));
            // console.timeEnd('foo'); 
        }
        </script>
        <meta charset="utf-8" />
        <title>JSequencer</title>
        <link type="text/css" rel="stylesheet" href="style/main.css">
    </head>
    <body onload="draw()">

    <div id="menu">
        <div id="note-lengths">    
            <div id="whole"><img src="images/whole-note.jpg" /></div>
            <div id="half"><img src="images/half-note.jpg" /></div>
            <div id="quarter"><img src="images/quarter-note.jpg" /></div>
            <div id="eight"><img src="images/eigth-note.jpg" /></div>
            <div id="sixteenth"><img src="images/sixteenth-note.jpg" /></div>
        </div>
        <div id="song-controls">
            <span>Tempo: </span><input id = "tempo" type="number" min="30" max="400" step="1" value="100">
            <button id="play-button"><img src="images/play.png" alt="play" /></button>
        </div>
        <div id="tracks-container">
            Tracks
            <select name="tracks" id="tracks">

            </select>
        </div>
    </div> 
    <div id="beat">

    </div>
    <div id="measure-counter-container">
        <div id="measure-counter">
            <canvas id="measure-counter-canvas" width="2000" height="25"></canvas>
        </div>    
    </div>

        
    <div id="main">
        <div id="piano-container">
            <div id="piano">
                 <canvas id="white-keys"  width="150"></canvas>                
                 <canvas id="black-keys"  width="150"></canvas>
            </div>
        </div>
        <div id="grid-container">
            <div id="grid">
                <canvas id="canvas-notes" width="2000"></canvas>
                <canvas id="canvas-grid" width="2000"></canvas>
            </div>
        </div>    
    </div>
    
    </body>
    <script type="application/javascript">
        document.getElementById("grid-container").onscroll = function() {
            document.getElementById("piano-container").scrollTop = this.scrollTop;
            document.getElementById("measure-counter-container").scrollLeft = this.scrollLeft;
        };
   </script>
</html>
   